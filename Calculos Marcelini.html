<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de An√°lisis de Soldadura v2 | F√°brica Marcelini</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Ocean & Amber -->
    <!-- Application Structure Plan: La estructura de dashboard se mantiene por su efectividad para el an√°lisis interactivo. Se ha realizado un redise√±o visual completo con una paleta de colores m√°s vibrante para mejorar la experiencia de usuario. El flujo sigue siendo: 1) KPIs principales. 2) Simulador de Producci√≥n interactivo. 3) Desglose visual del proceso. 4) Gr√°ficos de an√°lisis. 5) Tabla de par√°metros. La mejora principal es la precisi√≥n del c√°lculo de consumo de alambre, ahora basado en la geometr√≠a del cord√≥n (garganta de 5mm), lo que ofrece una estimaci√≥n te√≥rica m√°s exacta para la planificaci√≥n. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Resultados Clave -> Goal: Informar -> Viz/Presentation: Tarjetas de KPI con √≠conos -> Interaction: Actualizaci√≥n din√°mica -> Justification: Se actualiz√≥ el c√°lculo de alambre bas√°ndose en el volumen del cord√≥n (garganta de 5mm) para mayor precisi√≥n. Los √≠conos mejoran la legibilidad. -> Library/Method: HTML/Tailwind/JS.
        - Report Info: Escalamiento de producci√≥n -> Goal: Explorar/Planificar -> Viz/Presentation: Slider redise√±ado -> Interaction: El usuario modifica la cantidad de vigas -> Justification: La funcionalidad central se mantiene por su alto valor predictivo. -> Library/Method: HTML/JS.
        - Report Info: Tipos de soldadura -> Goal: Organizar/Explicar -> Viz/Presentation: Diagrama visual redise√±ado con nuevos colores -> Interaction: Informativo -> Justification: El nuevo dise√±o es m√°s claro y se alinea con la nueva identidad visual. -> Library/Method: HTML/Tailwind.
        - Report Info: Consumo Alambre vs. Gas -> Goal: Comparar -> Viz/Presentation: Gr√°fico de Anillo -> Interaction: Hover -> Justification: El gr√°fico ahora refleja la nueva proporci√≥n de consumo, m√°s precisa. Colores actualizados. -> Library/Method: Chart.js (Canvas).
        - Report Info: Proyecci√≥n de consumos -> Goal: Analizar tendencias -> Viz/Presentation: Gr√°fico de L√≠neas -> Interaction: Se actualiza en tiempo real -> Justification: Visualiza el crecimiento de requerimientos con la nueva base de c√°lculo. -> Library/Method: Chart.js (Canvas).
        - Gemini Feature 1: Optimization -> Goal: Advise -> Viz/Presentation: Text generation in a card -> Interaction: Button click -> Justification: Provides expert-level, actionable advice to enhance the process, adding significant value. -> Library/Method: Gemini API.
        - Gemini Feature 2: Executive Summary -> Goal: Summarize -> Viz/Presentation: Text generation in a card -> Interaction: Button click with dynamic data -> Justification: Converts simulation data into a shareable, professional summary, improving communication. -> Library/Method: Gemini API.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f9ff; /* light sky */
            color: #0c4a6e; /* sky-900 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .kpi-card {
            background-color: #FFFFFF;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px -5px rgba(14, 116, 144, 0.15);
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #f59e0b; /* amber-500 */
            cursor: pointer;
            border-radius: 50%;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #f59e0b; /* amber-500 */
            cursor: pointer;
            border-radius: 50%;
        }
        .gemini-card {
            min-height: 280px;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #f59e0b;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-sky-800 text-white shadow-lg">
        <div class="max-w-7xl mx-auto py-5 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold leading-tight">Dashboard de Soldadura 2.0</h1>
                <p class="text-sm text-sky-200 mt-1">Proyecto: Optimizaci√≥n de Vigas | F√°brica Marcelini</p>
            </div>
            <div class="text-right">
                <span class="text-xs font-semibold">C√ÅLCULO REFINADO</span>
                <p class="text-sm font-bold">Garganta: 5mm</p>
            </div>
        </div>
    </header>

    <main class="py-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            
            <section id="simulator" class="bg-white p-6 rounded-xl shadow-md border border-sky-100 mb-10">
                <div class="md:flex md:items-center md:justify-between">
                    <div class="flex-1 min-w-0">
                        <h2 class="text-2xl font-bold leading-7 text-sky-900 sm:truncate">Simulador de Producci√≥n</h2>
                        <p class="mt-1 text-sm text-slate-500">Ajuste la cantidad de vigas para proyectar los consumos y tiempos totales. Esta secci√≥n le permite planificar la producci√≥n bas√°ndose en los datos del reporte, transformando el an√°lisis en una herramienta interactiva.</p>
                    </div>
                </div>
                <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                    <div>
                        <label for="beam-slider" class="block text-sm font-medium text-slate-700">Cantidad de Vigas a Producir: <span id="beam-count-label" class="font-bold text-amber-600 text-lg">1</span></label>
                        <input id="beam-slider" type="range" min="1" max="100" value="1" class="w-full h-2 bg-sky-100 rounded-lg appearance-none cursor-pointer mt-2">
                    </div>
                    <div>
                        <label for="beam-input" class="block text-sm font-medium text-slate-700">O ingrese un valor exacto:</label>
                         <input id="beam-input" type="number" min="1" value="1" class="mt-2 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-amber-500 focus:border-amber-500 sm:text-sm">
                    </div>
                </div>
            </section>

            <section id="kpis">
                 <div class="text-center mb-8">
                    <h3 class="text-xl font-semibold text-sky-900">Resultados Clave para la Producci√≥n Seleccionada</h3>
                    <p class="text-slate-500">M√©tricas totales calculadas en tiempo real seg√∫n la cantidad de vigas del simulador.</p>
                </div>
                <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4">
                    <div class="kpi-card p-5 rounded-lg flex items-center border-l-4 border-sky-500">
                        <div class="mr-4 text-3xl">‚è±Ô∏è</div>
                        <div>
                            <dt class="text-sm font-medium text-slate-500 truncate">Tiempo de Producci√≥n</dt>
                            <dd class="mt-1 text-3xl font-semibold text-sky-900" id="total-time">26 Minutos</dd>
                        </div>
                    </div>
                    <div class="kpi-card p-5 rounded-lg flex items-center border-l-4 border-teal-500">
                         <div class="mr-4 text-3xl">‚öñÔ∏è</div>
                        <div>
                            <dt class="text-sm font-medium text-slate-500 truncate">Consumo de Alambre</dt>
                            <dd class="mt-1 text-3xl font-semibold text-sky-900" id="total-wire">2.65 kg</dd>
                        </div>
                    </div>
                    <div class="kpi-card p-5 rounded-lg flex items-center border-l-4 border-slate-500">
                        <div class="mr-4 text-3xl">üí®</div>
                        <div>
                            <dt class="text-sm font-medium text-slate-500 truncate">Consumo de Gas (CO‚ÇÇ)</dt>
                            <dd class="mt-1 text-3xl font-semibold text-sky-900" id="total-gas">1.45 kg</dd>
                        </div>
                    </div>
                     <div class="kpi-card p-5 rounded-lg flex items-center border-l-4 border-amber-500">
                        <div class="mr-4 text-3xl">üìä</div>
                        <div>
                            <dt class="text-sm font-medium text-slate-500 truncate">Alambre por Metro</dt>
                            <dd class="mt-1 text-3xl font-semibold text-sky-900" id="wire-per-meter">0.113 kg/m</dd>
                        </div>
                    </div>
                </div>
            </section>

             <section id="gemini-analysis" class="mt-12">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold text-sky-900">An√°lisis con IA Gemini</h2>
                    <p class="text-slate-500 max-w-2xl mx-auto">Potencie su an√°lisis con la inteligencia artificial de Google. Obtenga recomendaciones de expertos y genere res√∫menes ejecutivos al instante.</p>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md border flex flex-col gemini-card">
                        <h3 class="font-bold text-lg text-sky-800">Recomendaciones de Optimizaci√≥n</h3>
                        <p class="text-sm text-slate-600 mt-2 flex-grow">Obtenga sugerencias de un experto virtual para mejorar su proceso de soldadura bas√°ndose en los par√°metros actuales.</p>
                        <div id="optimizations-loader" class="hidden flex justify-center items-center my-4"><div class="loader"></div></div>
                        <div id="optimizations-result" class="text-sm text-slate-700 mt-4 prose prose-sm max-w-none"></div>
                        <button id="get-optimizations" class="mt-4 w-full bg-sky-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-sky-700 transition-colors">‚ú® Obtener Recomendaciones</button>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md border flex flex-col gemini-card">
                        <h3 class="font-bold text-lg text-sky-800">Resumen Ejecutivo</h3>
                        <p class="text-sm text-slate-600 mt-2 flex-grow">Genere un p√°rrafo conciso con los datos clave de la simulaci√≥n actual, listo para ser incluido en un informe o presentaci√≥n.</p>
                        <div id="summary-loader" class="hidden flex justify-center items-center my-4"><div class="loader"></div></div>
                        <div id="summary-result" class="text-sm text-slate-700 mt-4 prose prose-sm max-w-none"></div>
                        <button id="get-summary" class="mt-4 w-full bg-amber-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-amber-600 transition-colors">‚ú® Generar Resumen</button>
                    </div>
                </div>
            </section>

            <section id="process" class="mt-12">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold text-sky-900">Desglose del Proceso de Soldadura por Viga</h2>
                    <p class="text-slate-500 max-w-2xl mx-auto">La viga requiere dos t√©cnicas de soldadura distintas en sus caras superior e inferior. Comprender esta dualidad es clave para la optimizaci√≥n del proceso.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md border">
                        <h3 class="font-bold text-base text-sky-800">1. Soldadura Superior ("Paso Peregrino")</h3>
                        <p class="text-sm text-slate-600 mt-2">Se aplican cordones cortos e intermitentes para controlar el aporte t√©rmico y adaptarse a la geometr√≠a curva de la viga.</p>
                        <div class="mt-4 p-4 rounded-md bg-sky-50">
                            <p class="font-semibold text-sky-900">Visualizaci√≥n del Proceso:</p>
                            <div class="w-full h-8 mt-2 bg-slate-200 rounded flex items-center justify-around px-1">
                                <div class="h-4 w-1/6 bg-sky-600 rounded-sm"></div>
                                <div class="h-4 w-1/6 bg-sky-600 rounded-sm"></div>
                                <div class="h-4 w-1/6 bg-sky-600 rounded-sm"></div>
                                <div class="h-4 w-1/6 bg-sky-600 rounded-sm"></div>
                            </div>
                        </div>
                        <ul class="mt-4 space-y-2 text-sm text-slate-700">
                            <li class="flex justify-between"><span>Total de Cordones:</span><span class="font-semibold">53</span></li>
                            <li class="flex justify-between"><span>Longitud por Cord√≥n:</span><span class="font-semibold">13.5 cm</span></li>
                            <li class="flex justify-between border-t pt-2 mt-2"><span>Longitud Total Superior:</span><span class="font-semibold text-sky-700">7.16 metros</span></li>
                        </ul>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md border">
                        <h3 class="font-bold text-base text-sky-800">2. Soldadura Inferior (Cordones Continuos)</h3>
                        <p class="text-sm text-slate-600 mt-2">Se realizan dos cordones largos y continuos a lo largo de la viga para asegurar la m√°xima resistencia estructural en la base.</p>
                        <div class="mt-4 p-4 rounded-md bg-sky-50">
                             <p class="font-semibold text-sky-900">Visualizaci√≥n del Proceso:</p>
                             <div class="w-full h-8 mt-2 bg-slate-200 rounded flex items-center px-1">
                                <div class="h-4 w-full bg-sky-600 rounded-sm"></div>
                            </div>
                        </div>
                        <ul class="mt-4 space-y-2 text-sm text-slate-700">
                            <li class="flex justify-between"><span>Total de Cordones:</span><span class="font-semibold">2</span></li>
                            <li class="flex justify-between"><span>Longitud Promedio:</span><span class="font-semibold">~817.5 cm</span></li>
                            <li class="flex justify-between border-t pt-2 mt-2"><span>Longitud Total Inferior:</span><span class="font-semibold text-sky-700">16.35 metros</span></li>
                        </ul>
                    </div>
                </div>
            </section>
            
            <section id="charts" class="mt-12">
                 <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold text-sky-900">An√°lisis Visual de Datos</h2>
                    <p class="text-slate-500 max-w-2xl mx-auto">Los gr√°ficos interactivos permiten un an√°lisis m√°s profundo de los componentes de costo y tiempo del proceso de soldadura.</p>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md border">
                        <h3 class="font-semibold text-center mb-4 text-sky-800">Proyecci√≥n de Producci√≥n</h3>
                        <div class="chart-container">
                            <canvas id="projection-chart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md border">
                        <h3 class="font-semibold text-center mb-4 text-sky-800">Desglose de Consumibles por Viga (en kg)</h3>
                         <div class="chart-container">
                            <canvas id="consumables-chart"></canvas>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="parameters" class="mt-12">
                 <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold text-sky-900">Par√°metros T√©cnicos de Referencia</h2>
                    <p class="text-slate-500">Configuraci√≥n base utilizada durante las pruebas de soldadura.</p>
                </div>
                <div class="bg-white overflow-hidden shadow-md border rounded-lg">
                    <ul role="list" class="divide-y divide-slate-200 text-sm">
                        <li class="px-6 py-4 grid grid-cols-3 gap-4 hover:bg-sky-50"><span class="font-medium text-slate-800">Alambre de Aporte</span><span class="col-span-2 text-slate-600">ESAB Dual Shield 7100 (1.2 mm)</span></li>
                        <li class="px-6 py-4 grid grid-cols-3 gap-4 hover:bg-sky-50"><span class="font-medium text-slate-800">Gas de Protecci√≥n</span><span class="col-span-2 text-slate-600">100% CO‚ÇÇ @ 15 L/min</span></li>
                        <li class="px-6 py-4 grid grid-cols-3 gap-4 hover:bg-sky-50"><span class="font-medium text-slate-800">Par√°metros El√©ctricos</span><span class="col-span-2 text-slate-600">33.5 Voltios / 300 Amperes</span></li>
                        <li class="px-6 py-4 grid grid-cols-3 gap-4 hover:bg-sky-50"><span class="font-medium text-slate-800">Velocidad de Avance</span><span class="col-span-2 text-slate-600">45.45 cm/minuto</span></li>
                        <li class="px-6 py-4 grid grid-cols-3 gap-4 hover:bg-sky-50"><span class="font-medium text-slate-800">Tasa de Deposici√≥n</span><span class="col-span-2 text-slate-600">5.8 kg/hora (Estimada)</span></li>
                        <li class="px-6 py-4 grid grid-cols-3 gap-4 hover:bg-sky-50"><span class="font-medium text-slate-800">Equipo</span><span class="col-span-2 text-slate-600">2 torchas en simult√°neo</span></li>
                    </ul>
                </div>
            </section>
        </div>
    </main>
    
    <footer class="bg-sky-900 mt-12">
         <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm text-sky-200">
             <p>&copy; 2025 F√°brica Marcelini | Reporte Interactivo Potenciado por Gemini</p>
         </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const reportData = {
                timePerBeamMinutes: 25.85,
                wirePerBeamKg: 2.65,
                gasPerBeamKg: 1.45,
                wirePerMeterKg: 0.113
            };

            const slider = document.getElementById('beam-slider');
            const input = document.getElementById('beam-input');
            const countLabel = document.getElementById('beam-count-label');

            const timeDisplay = document.getElementById('total-time');
            const wireDisplay = document.getElementById('total-wire');
            const gasDisplay = document.getElementById('total-gas');
            const wirePerMeterDisplay = document.getElementById('wire-per-meter');
            
            const getOptimizationsBtn = document.getElementById('get-optimizations');
            const optimizationsResultEl = document.getElementById('optimizations-result');
            const optimizationsLoaderEl = document.getElementById('optimizations-loader');

            const getSummaryBtn = document.getElementById('get-summary');
            const summaryResultEl = document.getElementById('summary-result');
            const summaryLoaderEl = document.getElementById('summary-loader');

            let consumablesChart, projectionChart;

            async function callGeminiAPI(prompt, resultElement, loadingElement) {
                loadingElement.classList.remove('hidden');
                resultElement.classList.add('hidden');
                resultElement.innerHTML = '';

                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API request failed with status ${response.status}`);
                    }

                    const result = await response.json();
                    const candidate = result.candidates?.[0];
                    
                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        let text = candidate.content.parts[0].text;
                        text = text.replace(/\*\*(.*?)\*\*/g, '<strong class="text-sky-800">$1</strong>');
                        text = text.replace(/^\* (.*$)/gm, '<li class="mb-2 pl-4 relative"><span class="absolute left-0 top-1.5 w-1.5 h-1.5 bg-amber-500 rounded-full"></span>$1</li>');
                        text = text.replace(/(<li.*<\/li>)/gs, '<ul class="mt-2">$1</ul>');
                        text = text.replace(/\n/g, '<br>');
                        resultElement.innerHTML = text;
                    } else {
                        resultElement.textContent = 'No se pudo obtener una respuesta v√°lida de la API.';
                    }

                } catch (error) {
                    console.error('Error calling Gemini API:', error);
                    resultElement.textContent = 'Error al contactar el servicio de IA. Por favor, intente de nuevo.';
                } finally {
                    loadingElement.classList.add('hidden');
                    resultElement.classList.remove('hidden');
                }
            }
            
            getOptimizationsBtn.addEventListener('click', () => {
                const prompt = `Como ingeniero experto en soldadura de ESAB, analiza los siguientes par√°metros para un proceso FCAW-G en una viga estructural de acero:
                - Alambre: ESAB Dual Shield 7100 (1.2 mm)
                - Gas: 100% CO‚ÇÇ a 15 L/min
                - Par√°metros: 33.5 Voltios / 300 Amperes
                - Velocidad: 45.45 cm/min
                
                Proporciona 3 recomendaciones espec√≠ficas y accionables para optimizar el proceso, enfoc√°ndote en reducir salpicaduras, mejorar la apariencia del cord√≥n o aumentar la eficiencia. Justifica brevemente cada recomendaci√≥n. Usa un formato de lista con asteriscos y resalta los conceptos clave con doble asterisco.`;
                callGeminiAPI(prompt, optimizationsResultEl, optimizationsLoaderEl);
            });

            getSummaryBtn.addEventListener('click', () => {
                const beamCount = input.value;
                const totalTimeText = timeDisplay.textContent;
                const totalWireText = wireDisplay.textContent;
                const totalGasText = gasDisplay.textContent;

                const prompt = `Como gerente de producci√≥n, redacta un resumen ejecutivo de una sola p√°rrafo para una reuni√≥n de planificaci√≥n. Utiliza los siguientes datos de una simulaci√≥n de soldadura:
                - Cantidad de Vigas a Producir: ${beamCount}
                - Tiempo Total de Producci√≥n Estimado: ${totalTimeText}
                - Consumo Total de Alambre: ${totalWireText}
                - Consumo Total de Gas (CO‚ÇÇ): ${totalGasText}
                
                El resumen debe ser claro, conciso y resaltar los requerimientos clave de recursos y tiempo para el proyecto.`;
                callGeminiAPI(prompt, summaryResultEl, summaryLoaderEl);
            });


            function formatTime(totalMinutes) {
                if (totalMinutes < 60) {
                    return `${Math.round(totalMinutes)} Minutos`;
                }
                const hours = Math.floor(totalMinutes / 60);
                const minutes = Math.round(totalMinutes % 60);
                if (minutes === 0) {
                    return `${hours} Horas`;
                }
                return `${hours}h ${minutes}m`;
            }

            function updateDashboard(beamCount) {
                const totalTime = reportData.timePerBeamMinutes * beamCount;
                const totalWire = reportData.wirePerBeamKg * beamCount;
                const totalGas = reportData.gasPerBeamKg * beamCount;

                timeDisplay.textContent = formatTime(totalTime);
                wireDisplay.textContent = `${totalWire.toFixed(2)} kg`;
                gasDisplay.textContent = `${totalGas.toFixed(2)} kg`;
                wirePerMeterDisplay.textContent = `${reportData.wirePerMeterKg.toFixed(3)} kg/m`;
                countLabel.textContent = beamCount;
                
                updateProjectionChart(beamCount);
            }
            
            function createConsumablesChart() {
                const ctx = document.getElementById('consumables-chart').getContext('2d');
                consumablesChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Alambre de Aporte', 'Gas (CO‚ÇÇ)'],
                        datasets: [{
                            data: [reportData.wirePerBeamKg, reportData.gasPerBeamKg],
                            backgroundColor: ['#0ea5e9', '#64748b'], // sky-500, slate-500
                            borderColor: '#FFFFFF',
                            borderWidth: 4,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed !== null) {
                                            label += context.parsed.toFixed(2) + ' kg';
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            function createProjectionChart() {
                const ctx = document.getElementById('projection-chart').getContext('2d');
                projectionChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                        {
                            label: 'Consumo de Alambre (kg)',
                            data: [],
                            borderColor: '#0ea5e9', // sky-500
                            backgroundColor: 'rgba(14, 165, 233, 0.1)',
                            fill: true,
                            tension: 0.3
                        },
                        {
                            label: 'Tiempo de Producci√≥n (Horas)',
                            data: [],
                            borderColor: '#f59e0b', // amber-500
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                         scales: {
                            y: {
                                beginAtZero: true
                            }
                        },
                        plugins: {
                             legend: {
                                position: 'bottom',
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            }
                        }
                    }
                });
                updateProjectionChart(1);
            }
            
            function updateProjectionChart(currentBeamCount) {
                const maxBeams = Math.max(10, Math.ceil(currentBeamCount / 10) * 10);
                const step = Math.max(1, Math.ceil(maxBeams / 10));
                
                const newLabels = [];
                const newWireData = [];
                const newTimeData = [];

                for (let i = 1; i <= maxBeams; i += step) {
                    if(i > 1 && newLabels[newLabels.length-1] >= i) continue;
                    newLabels.push(i);
                    newWireData.push((reportData.wirePerBeamKg * i).toFixed(2));
                    newTimeData.push((reportData.timePerBeamMinutes * i / 60).toFixed(2));
                }
                
                const currentInt = parseInt(currentBeamCount);
                if (!newLabels.includes(currentInt)) {
                    const sortedLabels = [...newLabels, currentInt].sort((a, b) => a - b);
                    const insertIndex = sortedLabels.indexOf(currentInt);
                    newLabels.splice(insertIndex, 0, currentInt);
                    newWireData.splice(insertIndex, 0, (reportData.wirePerBeamKg * currentBeamCount).toFixed(2));
                    newTimeData.splice(insertIndex, 0, (reportData.timePerBeamMinutes * currentBeamCount / 60).toFixed(2));
                }

                projectionChart.data.labels = newLabels;
                projectionChart.data.datasets[0].data = newWireData;
                projectionChart.data.datasets[1].data = newTimeData;
                projectionChart.update();
            }

            slider.addEventListener('input', (e) => {
                const beamCount = e.target.value;
                input.value = beamCount;
                updateDashboard(beamCount);
            });
            
            input.addEventListener('input', (e) => {
                let beamCount = e.target.value;
                if (beamCount === '' || beamCount < 1) {
                    beamCount = 1;
                }
                if (parseInt(beamCount) > 100) {
                    beamCount = 100;
                    e.target.value = 100;
                }
                slider.value = beamCount;
                updateDashboard(beamCount);
            });

            createConsumablesChart();
            createProjectionChart();
            updateDashboard(1);
        });
    </script>

</body>
</html>


